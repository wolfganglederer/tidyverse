---
title: "<span style ='font-size: 165px;'>Tidyverse</span>"
knit: (function(inputFile, encoding) { 
  out_dir <- "docs";
  rmarkdown::render(inputFile,
                      encoding=encoding, 
                      output_file=file.path(dirname(inputFile), out_dir, 'index.html'))})
output:
  revealjs::revealjs_presentation:
    theme: black
    transition: slide
    center: true
    self_contained: true
---


## Tidyverse

```{r, echo=FALSE, message=FALSE,warning=FALSE}
library(tidyverse)
options(tibble.print_max = 8, tibble.print_min = 4)
```

Ist eine Sammlung von Paketen von Hadley Wickham

> - dplyr (Datenverarbeitung)
> - ggplot2 (Grafiken)
> - tidyr (Datenverarbeitung)
> - stringr (Verarbeitung von Strings Regex)
> - forcats (Factor-Variablen)
> - purrr (Funktionales Programmieren)
> - readr (Einlesen von Daten)

# dplyr
## 5 Verben

>- `filter()` Zeilen auswählen mit einer Bedingung
>- `select()` Spalten auswählen
>- `arrange()` Sortieren
>- `mutate()` Variablen hinzufügen
>- `summarise()` Zeilen aggregieren

## Beispiel

Alle Star Wars Figuren

```{r, warning=FALSE, message=FALSE}
starwars
```

# filter() 
## filter() 

`filter()` selektiert Zeilen die eine Bedingung erfüllen

```{r, warning=FALSE, message=FALSE}
filter(starwars, species == "Human")
```


## filter() 

Mehrere Bedingungen können durch Komma getrennt werden. Wirkt wie ein `&`

```{r, warning=FALSE, message=FALSE}
filter(starwars, species == "Human", gender == "female")
```


 
## filter() 

Komplexere Bedingungen sind natürlich auch möglich:

Vergleichs Operatoren:

`>, >=, <, <=, != , ==, %in%`


Boolsche Operatoren:

- `&` und
- `|` oder
- `xor(a,b)` entweder a oder b

## filter()

Übung:

Alle Menschen größer als 1.90m

<div class="fragment fade-up">
```{r, eval=FALSE}
filter(starwars, 
       height > 190 & species == "Human")
```
</div>

<div class="fragment fade-up">Blaue oder gelbe Augen und nicht menschlich</div>

<div class="fragment fade-up">
```{r, eval=FALSE}
filter(starwars, 
          eye_color %in% c("blue", "yellow"), 
          species != "Human")
```
</div>


# select()
## select()

- `rename()` behält alle Spalten und benennt um `rename(df, new = old)`
- `select()` selektiert Spalten

```{r}
select(starwars, name, homeworld)
```

## select()

Auswahl ist auch über mehrere Variablen möglich

```{r}
select(starwars, name:mass)
```

## select()

negative Auswahl mit -

```{r}
select(starwars, -name)
```


## select()

Selection helper

* `starts_with()`: Startet mit einem Prefix
* `ends_with()`: Endet mit einem Suffix
* `contains()`: Enthält einen String
* `matches()`: Matched eine RegEx
* `num_range()`: Ein numerischer Bereich x01, x02, x03.
* `one_of()`: Variablen in einem Character vector
* `everything()`: Alle Variablen.

## select()

```{r}
select(starwars, ends_with("color"))
```

## select()

Übung:

Stelle `homeworld` an den Anfang

<div class="fragment fade-up">
```{r, eval=FALSE}
select(starwars, homeworld, everything())
```
</div>

<div class="fragment fade-up">Benne `gender` in `sex` um</div>

<div class="fragment fade-up">
```{r, eval=FALSE}
rename(starwars, sex = gender)
```
</div>


# mutate()

## mutate()

- `mutate()` erzeugt neue Variablen
- `transmute()` erzeugt Variablen und behält nur die neuen Variablen

```{r}
starwars_short <- select(starwars, name:mass)
mutate(starwars_short, bmi = mass/(height/100)^2) 
```

## mutate()

Erzeugte Variablen können bereits referenziert werden

<div class="fragment fade-up">
```{r}
mutate(starwars_short,
       bmi = mass/(height/100)^2,
       adipositas = bmi >= 30)
```
</div>

## mutate()

Wichtige Erzeuger-Funktionen

- Arithmetische Operatoren `+, -, *, /, ^`
- Modulus Opratoren `%/%, %%`
- Logarithmen `log(), log2(), log10()` 
- Verschiebung `lead(), lag()`
- Kumulative Funktionen `cumsum(), cummean(), cummax() ...` 
    - RcppRoll für weitere Funktionen
- Logische Operatoren
- Rang-Funktionen `min_rank(), cume_dist(), percent_rank(), ...`
- Factor Funktionen `cut()`

## mutate()

Beispiel

```{r}
mutate(starwars_short,
       bmi = mass/(height/100)^2,
       weighted = cut(bmi, breaks = c(0, 18.5, 25, 30,Inf), 
                      labels = c("underweight", "normal", "overweight", "obese"), 
                      ordered_result = TRUE),
       bmi_rank = min_rank(bmi)) 
```

# arrange()

## arrange()

- Sortiert den Datensatz nach einer Variable. 
- Weitere Variablen werden benutzt um Bindungen zu brechen.
- Fehlende werte werden ans Ende sortiert,

```{r}
arrange(starwars, desc(height), mass)
```

